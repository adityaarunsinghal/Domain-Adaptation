2021-03-12 17:00:42,031 INFO     | building dictionary first...
2021-03-12 17:00:42,042 WARNING  | Overriding opt["task"] to empathic_conversations (previously: internal:blended_skill_talk,wizard_of_wikipedia,convai2:normalized,empathetic_dialogues)
2021-03-12 17:00:42,042 WARNING  | Overriding opt["model_file"] to /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model (previously: /checkpoint/edinan/20200331/finetune_bst_gen_baseline_convai2_normal/de6/model)
2021-03-12 17:00:42,042 WARNING  | Overriding opt["batchsize"] to 96 (previously: 128)
2021-03-12 17:00:42,042 WARNING  | Overriding opt["num_epochs"] to 500.0 (previously: -1)
2021-03-12 17:00:42,043 WARNING  | Overriding opt["validation_every_n_secs"] to 36000.0 (previously: -1)
2021-03-12 17:00:42,043 WARNING  | Overriding opt["save_every_n_secs"] to 3600.0 (previously: -1)
2021-03-12 17:00:42,043 WARNING  | Overriding opt["n_layers"] to 4 (previously: 2)
2021-03-12 17:00:42,043 WARNING  | Overriding opt["learningrate"] to 0.0008 (previously: 7e-06)
2021-03-12 17:00:42,043 WARNING  | Overriding opt["history_size"] to 5 (previously: -1)
2021-03-12 17:00:42,043 WARNING  | Loading model with `--beam-block-full-context false`
2021-03-12 17:00:42,054 WARNING  | your model is being loaded with opts that do not exist in the model you are initializing the weights with: verbose: True,download_path: None,datapath: /ext3/miniconda3/lib/python3.8/site-packages/data,load_from_checkpoint: True,interactive_mode: False
2021-03-12 17:00:42,054 WARNING  | your model is being loaded with opts that differ from the model you are initializing the weights with. Add the following args to your run command to change this: 
--num-epochs -1 --bpe-vocab /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict-vocab.json --bpe-merge /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict-merges.txt --dict-loaded True
2021-03-12 17:00:42,055 INFO     | Using CUDA
2021-03-12 17:00:42,055 INFO     | loading dictionary from /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict
2021-03-12 17:00:42,076 INFO     | num words = 8008
2021-03-12 17:01:29,467 INFO     | Total parameters: 2,696,268,800 (2,695,613,440 trainable)
2021-03-12 17:01:29,485 INFO     | Loading existing model params from /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint
2021-03-12 17:03:31,107 INFO     | Opt:
2021-03-12 17:03:31,108 INFO     |     activation: gelu
2021-03-12 17:03:31,108 INFO     |     adafactor_eps: '[1e-30, 0.001]'
2021-03-12 17:03:31,108 INFO     |     adam_eps: 1e-08
2021-03-12 17:03:31,108 INFO     |     add_p1_after_newln: False
2021-03-12 17:03:31,108 INFO     |     aggregate_micro: False
2021-03-12 17:03:31,108 INFO     |     allow_missing_init_opts: False
2021-03-12 17:03:31,108 INFO     |     attention_dropout: 0.0
2021-03-12 17:03:31,108 INFO     |     batchsize: 96
2021-03-12 17:03:31,108 INFO     |     beam_block_full_context: False
2021-03-12 17:03:31,108 INFO     |     beam_block_list_filename: None
2021-03-12 17:03:31,108 INFO     |     beam_block_ngram: 3
2021-03-12 17:03:31,108 INFO     |     beam_context_block_ngram: 3
2021-03-12 17:03:31,108 INFO     |     beam_delay: 30
2021-03-12 17:03:31,108 INFO     |     beam_length_penalty: 0.65
2021-03-12 17:03:31,108 INFO     |     beam_min_length: 20
2021-03-12 17:03:31,108 INFO     |     beam_size: 10
2021-03-12 17:03:31,108 INFO     |     betas: '[0.9, 0.999]'
2021-03-12 17:03:31,108 INFO     |     bpe_add_prefix_space: True
2021-03-12 17:03:31,108 INFO     |     bpe_debug: False
2021-03-12 17:03:31,108 INFO     |     bpe_dropout: None
2021-03-12 17:03:31,108 INFO     |     bpe_merge: /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict-merges.txt
2021-03-12 17:03:31,109 INFO     |     bpe_vocab: /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict-vocab.json
2021-03-12 17:03:31,110 INFO     |     compute_tokenized_bleu: False
2021-03-12 17:03:31,110 INFO     |     datapath: /ext3/miniconda3/lib/python3.8/site-packages/data
2021-03-12 17:03:31,110 INFO     |     datatype: train
2021-03-12 17:03:31,110 INFO     |     delimiter: '  '
2021-03-12 17:03:31,110 INFO     |     dict_class: parlai.core.dict:DictionaryAgent
2021-03-12 17:03:31,110 INFO     |     dict_endtoken: __end__
2021-03-12 17:03:31,110 INFO     |     dict_file: /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict
2021-03-12 17:03:31,110 INFO     |     dict_include_test: False
2021-03-12 17:03:31,110 INFO     |     dict_include_valid: False
2021-03-12 17:03:31,110 INFO     |     dict_initpath: None
2021-03-12 17:03:31,110 INFO     |     dict_language: english
2021-03-12 17:03:31,110 INFO     |     dict_loaded: True
2021-03-12 17:03:31,110 INFO     |     dict_lower: False
2021-03-12 17:03:31,110 INFO     |     dict_max_ngram_size: -1
2021-03-12 17:03:31,110 INFO     |     dict_maxexs: -1
2021-03-12 17:03:31,110 INFO     |     dict_maxtokens: -1
2021-03-12 17:03:31,110 INFO     |     dict_minfreq: 0
2021-03-12 17:03:31,110 INFO     |     dict_nulltoken: __null__
2021-03-12 17:03:31,110 INFO     |     dict_starttoken: __start__
2021-03-12 17:03:31,110 INFO     |     dict_textfields: text,labels
2021-03-12 17:03:31,110 INFO     |     dict_tokenizer: bytelevelbpe
2021-03-12 17:03:31,110 INFO     |     dict_unktoken: __unk__
2021-03-12 17:03:31,110 INFO     |     display_examples: False
2021-03-12 17:03:31,110 INFO     |     download_path: None
2021-03-12 17:03:31,110 INFO     |     dropout: 0.1
2021-03-12 17:03:31,110 INFO     |     dynamic_batching: None
2021-03-12 17:03:31,110 INFO     |     embedding_projection: random
2021-03-12 17:03:31,110 INFO     |     embedding_size: 2560
2021-03-12 17:03:31,110 INFO     |     embedding_type: random
2021-03-12 17:03:31,110 INFO     |     embeddings_scale: True
2021-03-12 17:03:31,110 INFO     |     eval_batchsize: None
2021-03-12 17:03:31,110 INFO     |     eval_dynamic_batching: None
2021-03-12 17:03:31,110 INFO     |     evaltask: None
2021-03-12 17:03:31,110 INFO     |     ffn_size: 10240
2021-03-12 17:03:31,110 INFO     |     force_fp16_tokens: True
2021-03-12 17:03:31,110 INFO     |     fp16: True
2021-03-12 17:03:31,110 INFO     |     fp16_impl: mem_efficient
2021-03-12 17:03:31,110 INFO     |     gpu: -1
2021-03-12 17:03:31,110 INFO     |     gradient_clip: 0.1
2021-03-12 17:03:31,110 INFO     |     hide_labels: False
2021-03-12 17:03:31,110 INFO     |     history_add_global_end_token: end
2021-03-12 17:03:31,110 INFO     |     history_reversed: False
2021-03-12 17:03:31,110 INFO     |     history_size: 5
2021-03-12 17:03:31,111 INFO     |     image_cropsize: 224
2021-03-12 17:03:31,111 INFO     |     image_mode: raw
2021-03-12 17:03:31,111 INFO     |     image_size: 256
2021-03-12 17:03:31,111 INFO     |     include_checked_sentence: True
2021-03-12 17:03:31,111 INFO     |     include_knowledge: True
2021-03-12 17:03:31,111 INFO     |     include_knowledge_separator: False
2021-03-12 17:03:31,111 INFO     |     inference: beam
2021-03-12 17:03:31,111 INFO     |     init_model: /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint
2021-03-12 17:03:31,111 INFO     |     init_opt: None
2021-03-12 17:03:31,111 INFO     |     interactive_mode: False
2021-03-12 17:03:31,111 INFO     |     invsqrt_lr_decay_gamma: -1
2021-03-12 17:03:31,111 INFO     |     label_truncate: 128
2021-03-12 17:03:31,111 INFO     |     label_type: response
2021-03-12 17:03:31,111 INFO     |     learn_positional_embeddings: False
2021-03-12 17:03:31,111 INFO     |     learningrate: 0.0008
2021-03-12 17:03:31,111 INFO     |     load_from_checkpoint: True
2021-03-12 17:03:31,111 INFO     |     log_every_n_secs: 10.0
2021-03-12 17:03:31,111 INFO     |     loglevel: info
2021-03-12 17:03:31,111 INFO     |     lr_scheduler: reduceonplateau
2021-03-12 17:03:31,111 INFO     |     lr_scheduler_decay: 0.5
2021-03-12 17:03:31,111 INFO     |     lr_scheduler_patience: 3
2021-03-12 17:03:31,111 INFO     |     max_lr_steps: -1
2021-03-12 17:03:31,111 INFO     |     max_train_time: 27647.999999999996
2021-03-12 17:03:31,111 INFO     |     metrics: default
2021-03-12 17:03:31,111 INFO     |     model: transformer/generator
2021-03-12 17:03:31,111 INFO     |     model_file: /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model
2021-03-12 17:03:31,111 INFO     |     model_parallel: True
2021-03-12 17:03:31,111 INFO     |     momentum: 0
2021-03-12 17:03:31,111 INFO     |     multitask_weights: '[1.0, 3.0, 3.0, 3.0]'
2021-03-12 17:03:31,111 INFO     |     n_decoder_layers: 24
2021-03-12 17:03:31,111 INFO     |     n_encoder_layers: 2
2021-03-12 17:03:31,111 INFO     |     n_heads: 32
2021-03-12 17:03:31,111 INFO     |     n_layers: 4
2021-03-12 17:03:31,111 INFO     |     n_positions: 128
2021-03-12 17:03:31,111 INFO     |     n_segments: 0
2021-03-12 17:03:31,111 INFO     |     nesterov: True
2021-03-12 17:03:31,111 INFO     |     no_cuda: False
2021-03-12 17:03:31,111 INFO     |     num_epochs: 500.0
2021-03-12 17:03:31,111 INFO     |     num_topics: 5
2021-03-12 17:03:31,111 INFO     |     numthreads: 1
2021-03-12 17:03:31,111 INFO     |     nus: [0.7]
2021-03-12 17:03:31,111 INFO     |     optimizer: mem_eff_adam
2021-03-12 17:03:31,111 INFO     |     output_scaling: 1.0
2021-03-12 17:03:31,112 INFO     |     override: "{'task': 'empathic_conversations', 'model_file': '/ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model', 'model': 'transformer/generator', 'batchsize': 96, 'num_epochs': 500.0, 'validation_every_n_secs': 36000.0, 'save_every_n_secs': 3600.0, 'n_layers': 4, 'optimizer': 'mem_eff_adam', 'learningrate': 0.0008, 'history_size': 5, 'verbose': True}"
2021-03-12 17:03:31,112 INFO     |     parlai_home: /checkpoint/edinan/20200331/finetune_bst_gen_baseline_convai2_normal/ParlAI
2021-03-12 17:03:31,112 INFO     |     person_tokens: False
2021-03-12 17:03:31,112 INFO     |     rank_candidates: False
2021-03-12 17:03:31,112 INFO     |     relu_dropout: 0.0
2021-03-12 17:03:31,112 INFO     |     remove_political_convos: False
2021-03-12 17:03:31,112 INFO     |     save_after_valid: True
2021-03-12 17:03:31,112 INFO     |     save_every_n_secs: 3600.0
2021-03-12 17:03:31,112 INFO     |     share_word_embeddings: True
2021-03-12 17:03:31,112 INFO     |     short_final_eval: False
2021-03-12 17:03:31,112 INFO     |     show_advanced_args: False
2021-03-12 17:03:31,112 INFO     |     skip_generation: False
2021-03-12 17:03:31,112 INFO     |     special_tok_lst: None
2021-03-12 17:03:31,112 INFO     |     split_lines: False
2021-03-12 17:03:31,112 INFO     |     starttime: Mar31_06-04
2021-03-12 17:03:31,112 INFO     |     task: empathic_conversations
2021-03-12 17:03:31,112 INFO     |     temperature: 1.0
2021-03-12 17:03:31,112 INFO     |     tensorboard_log: False
2021-03-12 17:03:31,112 INFO     |     tensorboard_logdir: None
2021-03-12 17:03:31,112 INFO     |     text_truncate: 128
2021-03-12 17:03:31,112 INFO     |     topk: 10
2021-03-12 17:03:31,112 INFO     |     topp: 0.9
2021-03-12 17:03:31,112 INFO     |     train_experiencer_only: False
2021-03-12 17:03:31,112 INFO     |     truncate: 128
2021-03-12 17:03:31,112 INFO     |     update_freq: 2
2021-03-12 17:03:31,112 INFO     |     use_reply: label
2021-03-12 17:03:31,112 INFO     |     validation_cutoff: 1.0
2021-03-12 17:03:31,112 INFO     |     validation_every_n_epochs: 0.25
2021-03-12 17:03:31,112 INFO     |     validation_every_n_secs: 36000.0
2021-03-12 17:03:31,112 INFO     |     validation_max_exs: -1
2021-03-12 17:03:31,112 INFO     |     validation_metric: ppl
2021-03-12 17:03:31,112 INFO     |     validation_metric_mode: min
2021-03-12 17:03:31,112 INFO     |     validation_patience: 10
2021-03-12 17:03:31,112 INFO     |     validation_share_agent: False
2021-03-12 17:03:31,112 INFO     |     variant: prelayernorm
2021-03-12 17:03:31,112 INFO     |     verbose: True
2021-03-12 17:03:31,112 INFO     |     warmup_rate: 0.0001
2021-03-12 17:03:31,112 INFO     |     warmup_updates: 100
2021-03-12 17:03:31,112 INFO     |     weight_decay: None
2021-03-12 17:03:32,917 INFO     | creating task(s): empathic_conversations
2021-03-12 17:03:33,039 INFO     | Loading ParlAI text data: /scratch/as11919/empathic_conversations_data/empathic_conversations_train.txt
2021-03-12 17:03:33,248 INFO     | training...
2021-03-12 17:03:36,289 INFO     | Overflow: setting loss scale to 65536.0
2021-03-12 17:03:37,816 INFO     | time:70102s total_exs:2562731 epochs:619.02 time_left:0s
    clip  ctpb  ctps  exps  exs  fp16_loss_scalar  gnorm  gpu_mem  loss    lr  ltpb  \
       0  1321 383.9 27.36   96             65536     -1    .7375 3.591 .0008  1963   
    ltps   ppl  token_acc  total_train_updates  tpb   tps   ups  
   570.4 36.28      .2547                 7734 3284 954.3 .2908

2021-03-12 17:03:37,816 INFO     | num_epochs completed:500.0 time elapsed:70102.08678507805s
2021-03-12 17:04:37,934 WARNING  | your model is being loaded with opts that do not exist in the model you are initializing the weights with: verbose: True,download_path: None,datapath: /ext3/miniconda3/lib/python3.8/site-packages/data,load_from_checkpoint: True,interactive_mode: False
2021-03-12 17:04:37,934 WARNING  | your model is being loaded with opts that differ from the model you are initializing the weights with. Add the following args to your run command to change this: 
--num-epochs -1
2021-03-12 17:04:37,934 INFO     | Using CUDA
2021-03-12 17:04:37,934 INFO     | loading dictionary from /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint.dict
2021-03-12 17:04:37,945 INFO     | num words = 8008
2021-03-12 17:05:14,323 INFO     | Total parameters: 2,696,268,800 (2,695,613,440 trainable)
2021-03-12 17:05:14,339 INFO     | Loading existing model params from /ext3/miniconda3/lib/python3.8/site-packages/data/models/blender/blender_3B/model.checkpoint
2021-03-12 17:07:10,869 INFO     | creating task(s): empathic_conversations
2021-03-12 17:07:10,870 INFO     | Loading ParlAI text data: /scratch/as11919/empathic_conversations_data/empathic_conversations_valid.txt
Done!
